[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

# 1. FastAPI (The Web Server)
[program:web]
command=uvicorn app.main:app --host 0.0.0.0 --port 10000
directory=/app
autostart=true
autorestart=true
# Redirect logs to stdout so Render captures them
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# 2. Celery Worker (The Background Processor)
[program:worker]
# --concurrency=2 prevents the worker from hogging all RAM on the free/starter tier
command=celery -A app.celery_app worker --loglevel=info --concurrency=2
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# 3. Celery Beat (The Scheduler)
[program:beat]
# Storing the schedule in /tmp avoids permission errors in some container setups
command=celery -A app.celery_app beat --loglevel=info --schedule=/tmp/celerybeat-schedule
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0